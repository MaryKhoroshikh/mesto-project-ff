(()=>{"use strict";function e(e){e.classList.add("popup_is-opened","popup_is-animated"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.code&&t(document.querySelector(".popup_is-opened"))}function o(e){e.target===e.currentTarget&&t(e.target)}var r,c,a={baseUrl:"https://nomoreparties.co/v1/wff-cohort-28/",headers:{authorization:"78d3b3a3-1ec4-4d78-97c9-c99f9bcb0626","Content-Type":"application/json"}},i=function(){return fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},u=function(){return fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function s(t,n,o,i,u){var s=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),l=s.querySelector(".card__image"),d=s.querySelector(".card__delete-button"),p=s.querySelector(".card__like-button"),f=s.querySelector(".card__number-of-likes"),m=t.name,_=t.likes.some((function(e){return e._id===u}));return f.textContent=t.likes.length,l.src=t.link,l.alt=m,s.querySelector(".card__title").textContent=m,t.owner._id!==u&&d.remove(),_&&p.classList.toggle("card__like-button_is-active"),d.addEventListener("click",(function(n){e(document.querySelector(".popup_type_confirm-deletion")),r=t,c=n})),p.addEventListener("click",(function(e){_?function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(t){o(e),f.textContent=t.likes.length,_=!1})).catch((function(e){return console.log("Произошла ошибка: ".concat(e))})):function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(t){o(e),f.textContent=t.likes.length,_=!0})).catch((function(e){return console.log("Произошла ошибка: ".concat(e))}))})),l.addEventListener("click",(function(){return i(l.src,l.alt)})),s}function l(e){e.target.classList.toggle("card__like-button_is-active")}var d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},p=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(d.inputErrorClass),n.classList.remove(d.errorClass),n.textContent=""};function f(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(d.inactiveButtonClass)):(t.disabled=!0,t.classList.add(d.inactiveButtonClass))}var m=function(e){var t=Array.from(e.querySelectorAll(d.inputSelector)),n=e.querySelector(d.submitButtonSelector);f(t,n),t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(d.inputErrorClass),o.textContent=n,o.classList.add(d.errorClass)}(e,t,t.validationMessage)})(e,o),f(t,n)}))}))},_=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);o.disabled=!0,o.classList.add(t.inactiveButtonClass),n.forEach((function(t){return p(e,t)}))},v="51e16379f74f19a5d50fc63e",y="Сохранить",h="Сохранение...",S="Удаление...",k=document.querySelector(".content"),b=k.querySelector(".places").querySelector(".places__list"),q=k.querySelector(".profile"),E=q.querySelector(".profile__title"),L=q.querySelector(".profile__description"),g=q.querySelector(".profile__image"),C=q.querySelector(".profile__add-button"),j=q.querySelector(".profile__edit-button"),x=document.querySelector(".popup_type_image"),P=x.querySelector(".popup__image"),U=x.querySelector(".popup__caption"),A=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup_type_edit"),w=document.querySelector(".popup_type_avatar"),B=document.querySelector(".popup_type_confirm-deletion"),D=document.forms.confirm_deletion,N=document.forms.edit_avatar,O=N.elements.avatar,J=document.forms.edit_profile,M=J.elements.name,H=J.elements.description,I=document.forms.new_place,V=I.elements.place_name,z=I.elements.link;function F(t,n){P.src=t,U.textContent=n,e(x)}function G(e,t,n,o){t.querySelector(".popup__button").textContent=e?n:o}Promise.all([i,u]).then((function(){u().then((function(e){E.textContent=e.name,L.textContent=e.about,g.style.backgroundImage='url("'.concat(e.avatar,'")')})).catch((function(e){return console.log("Произошла ошибка: ".concat(e))})),i().then((function(e){e.forEach((function(e){b.append(s(e,0,l,F,v))}))})).catch((function(e){return console.log("Произошла ошибка: ".concat(e))}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault})),m(e)}))}(d),j.addEventListener("click",(function(){_(J,d),M.value=E.textContent,H.value=L.textContent,e(T)})),C.addEventListener("click",(function(){_(I,d),I.reset(),e(A)})),g.addEventListener("click",(function(){_(N,d),N.reset(),e(w)})),I.addEventListener("submit",(function(e){var n;e.preventDefault(),G(!0,I,h,y),(n={name:V.value,link:z.value,owner:{_id:v}},fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:n.name,link:n.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){b.prepend(s(e,0,l,F,v))})).catch((function(e){return console.log("Произошла ошибка: ".concat(e))})).finally((function(){t(A),G(!1,I,h,y),I.reset()}))})),J.addEventListener("submit",(function(e){e.preventDefault(),G(!0,J,h,y),function(e,t){return fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(M,H).catch((function(e){return console.log("Произошла ошибка: ".concat(e))})).finally((function(){E.textContent=M.value,L.textContent=H.value,G(!1,J,h,y),t(T)}))})),N.addEventListener("submit",(function(e){e.preventDefault(),G(!0,N,h,y),function(e){return fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(O).catch((function(e){return console.log("Произошла ошибка: ".concat(e))})).finally((function(){g.style.backgroundImage='url("'.concat(O.value,'")'),t(w),G(!1,N,h,y),N.reset()}))})),D.addEventListener("submit",(function(e){var n;e.preventDefault(),G(!0,D,S,"Да"),(n=r,fetch("".concat(a.baseUrl,"/cards/").concat(n._id),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).catch((function(e){return console.log("Произошла ошибка: ".concat(e))})).finally((function(){(function(e){e.target.closest(".places__item").remove()})(c),t(B),G(!1,D,S,"Да")}))})),x.querySelector(".popup__close").addEventListener("click",(function(){return t(x)})),A.querySelector(".popup__close").addEventListener("click",(function(){return t(A)})),T.querySelector(".popup__close").addEventListener("click",(function(){return t(T)})),w.querySelector(".popup__close").addEventListener("click",(function(){return t(w)})),B.querySelector(".popup__close").addEventListener("click",(function(){return t(B)})),x.addEventListener("click",o),A.addEventListener("click",o),T.addEventListener("click",o),w.addEventListener("click",o),B.addEventListener("click",o)})();